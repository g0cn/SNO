/*
 åœ¨å¾®ä¿¡ä¸­æ‰“å¼€æ·˜å®ç­‰è¢«å±è”½é“¾æŽ¥ï¼Œç‚¹å‡» Surge/QuantumultX é€šçŸ¥è·³è½¬åˆ° Safari æˆ–æ·˜å® App
*/

const TAOPAO = "æ·˜å®";
const LINK = "é“¾æŽ¥";
const OPEN = "ç‚¹å‡»æ‰“å¼€";

const str = $response.body;
const openUrl = str.match(/:&#x2f;&#x2f;(\S*)"}/)[1].replace(/&#x2f;/g, '/').replace(/&amp;/g, '&').split("\"")[0];

const $ = new cmp();

if (openUrl.indexOf("m.tb.cn") !== -1) {
    $.notify(``, ``, `${OPEN}${TAOPAO}`, `taobao://${openUrl}`);
} else {
    $.notify(``, ``, `ðŸ”—${OPEN}${LINK}`, `https://${openUrl}`);
}

$done({ body: $response.body });

function cmp() {
    const isQuanX = typeof $task !== "undefined";
    const isLoon = typeof $loon !== "undefined";
    const isSurge = typeof $httpClient !== "undefined" && !isLoon;

    return {
        notify: (title, subtitle, message, url) => {
            if (isLoon) {
                $notification.post(title, subtitle, message, url);
            }

            if (isQuanX) {
                $notify(title, subtitle, message, { "open-url": url });
            }

            if (isSurge) {
                $notification.post(title, subtitle, message, { url });
            }
        }
    };
}